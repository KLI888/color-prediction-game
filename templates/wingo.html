<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>49Club</title>
    <link rel="stylesheet" href="/static/style/wingo.css">
    <link rel="stylesheet" href="/static/style/utils.css">
    <!-- <link href="https://cdn.jsdelivr.net/npm/remixicon@4.3.0/fonts/remixicon.css" rel="stylesheet" /> -->
    <style>
        .game_result {
            padding: 10px 15px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: auto;
        }

        table,
        th,
        td {
            /* border: 1px solid black; */
        }

        th,
        td {
            padding: 10px;
            text-align: left;
        }

        th {
            background-color: #F95959;
            color: #fff;
        }
    </style>
</head>

<body>
    <section class="main_section">
        <header>
            <div class="navbar">
                <div class="nav_back">
                    <a href="/"><i class="ri-arrow-left-s-line"></i></a>
                </div>
                <div class="logo">
                    <img src="/static/assets/logo2.png" alt="">
                </div>
                <div class="nav_icon">
                    <div class="mail">
                        <a><i class="ri-customer-service-2-line"></i></a>
                    </div>
                    <div class="down">
                        <i class="ri-download-cloud-fill"></i>
                    </div>
                </div>
            </div>
            <div class="balance">
                <div class="balance_amount">
                    <h3>â‚¹{{profile.user_balance}}</h3>
                    <p><i class="ri-wallet-3-fill"></i> Wallet ballance</p>
                </div>
                <div class="balance_btns">
                    <a href="/withdrawPage" class="withdraw_btn">Withdraw</a>
                    <a href="/depositePage" class="deposite_btn">Deposit</a>
                </div>
            </div>
            <div class="main_details">
                <h1><i class="ri-volume-up-fill"></i></h1>
                <div class="details_text">
                    <p>Lorem ipsum dolor sit amet consectetur adipisicing elit. Dolorem debitis pariatur</p>
                </div>
                <div class="details_btn"><i class="ri-fire-fill"></i> Details</div>
            </div>
            <div class="wingo_times">
                <div class="wingo_time_card active">
                    <img src="/static/assets/clock.png" alt="">
                    <p>Win Go 30<br>second</p>
                </div>
                <div class="wingo_time_card">
                    <img src="/static/assets/clock2.png" alt="">
                    <p>Win Go 1<br>minute</p>
                </div>
                <div class="wingo_time_card">
                    <img src="/static/assets/clock2.png" alt="">
                    <p>Win Go 3<br>minute</p>
                </div>
                <div class="wingo_time_card">
                    <img src="/static/assets/clock2.png" alt="">
                    <p>Win Go 5<br>minute</p>
                </div>
            </div>
        </header>
        <main>
            <div class="main_ticket">
                <div class="ticket_left">
                    <a href=""><i class="ri-article-fill"></i> How to play</a><br><br>
                    <p>Win Go 30 seconds</p>
                    <p>Grow your money here.</p>
                </div>
                <div class="ticket_right">
                    <p>Time remaining</p>
                    <div class="ticket_time">
                        <div class="time">0</div>
                        <div class="time">0</div>
                        <div class="time">:</div>
                        <div class="time">0</div>
                        <div class="time">0</div>
                    </div>
                    <p id="game_round_id"></p>
                </div>
            </div>
            <div class="game_window">
                <div class="game_color">
                    <p class="game_color_cl" id="color_green">Green</p>
                    <p class="game_color_cl" id="color_violet">Violet</p>
                    <p class="game_color_cl" id="color_red">Red</p>
                </div>
                <div class="game_number">
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="0">
                        <img src="/static/assets/0.png" alt="">
                    </span>
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="1">
                        <img src="/static/assets/1.png" alt="">
                    </span>
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="2">
                        <img src="/static/assets/2.png" alt="">
                    </span>
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="3">
                        <img src="/static/assets/3.png" alt="">
                    </span>
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="4">
                        <img src="/static/assets/4.png" alt="">
                    </span>
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="5">
                        <img src="/static/assets/5.png" alt="">
                    </span>
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="6">
                        <img src="/static/assets/6.png" alt="">
                    </span>
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="7">
                        <img src="/static/assets/7.png" alt="">
                    </span>
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="8">
                        <img src="/static/assets/8.png" alt="">
                    </span>
                    <span class="game_number_cl">
                        <input type="hidden" name="" value="9">
                        <img src="/static/assets/9.png" alt="">
                    </span>
                </div>
                <div class="game_size">
                    <div class="game_size_cl size_big">Big</div>
                    <div class="game_size_cl size_small">Small</div>
                </div>
            </div>
            <div class="game_result">
                <table>
                    <thead>
                        <tr>
                            <th>Period</th>
                            <th>Number</th>
                            <th>Big/Small</th>
                            <th>Color</th>
                        </tr>
                    </thead>
                    <tbody id="results">
                        <tr>
                            <td id="round_id"></td>
                            <td></td>
                            <td></td>
                            <td id="win_color"></td>
                        </tr>
                        <!-- Add more rows as needed -->
                        {% for result in page_obj %}
                        <tr>
                            <td id="round_id">{{ result.round.game_id }}</td>
                            <td></td>
                            <td></td>
                            <td id="win_color"> {{ result.win_color }}</td>
                        </tr>
                        {% endfor %}

                    </tbody>

                </table>
                <div class="pagination">
                    <span class="step-links">
                        {% if page_obj.has_previous %}
                        <a href="?page=1">&laquo; first</a>
                        <a href="?page={{ page_obj.previous_page_number }}">previous</a>
                        {% endif %}

                        <span class="current">
                            Page {{ page_obj.number }} of {{ page_obj.paginator.num_pages }}.
                        </span>

                        {% if page_obj.has_next %}
                        <a href="?page={{ page_obj.next_page_number }}">next</a>
                        <a href="?page={{ page_obj.paginator.num_pages }}">last &raquo;</a>
                        {% endif %}
                    </span>
                </div>
            </div>

        </main>
        <div class="buy_form_div" id="buy_form_div">
            <section id="buy_color_form" class="buy_form_color">
                <form action="">
                    <div class="buy_form">
                        <div class="buy_heading">
                            <h3>Win Go 5Min</h3>
                            <p>Selected: <span id="selected_color">None</span></p>
                        </div>


                        <div class="buy_balance">
                            <p>Balance</p>
                            <div>
                                <span id="balance_value_1" class="balance_value active">1</span>
                                <span id="balance_value_2" class="balance_value">10</span>
                                <span id="balance_value_3" class="balance_value">100</span>
                                <span id="balance_value_4" class="balance_value">1000</span>
                            </div>
                        </div>
                        <div class="buy_quantity">
                            <p>Quantity</p>
                            <div>
                                <span id="dec_quantity" class="active">-</span>
                                <span id="quantity_value">1</span>
                                <span id="inc_quantity" class="active">+</span>
                            </div>
                        </div>
                        <div class="buy_multiply">
                            <span class="multiply_value active">1</span>
                            <span class="multiply_value">5</span>
                            <span class="multiply_value">10</span>
                            <span class="multiply_value">20</span>
                            <span class="multiply_value">50</span>
                            <span class="multiply_value">100</span>
                        </div>

                        <div class="buy_policy">
                            <input type="radio">
                            <p>I agree</p><span>|Pre-sale rules|</span>
                        </div>
                        <div class="buy_btn">
                            <p id="buy_form_cancle">Cancle</p>
                            <input id="buy_btn_total" type="submit" value="Total amount â‚¹1.00">
                        </div>
                    </div>
                </form>
            </section>
        </div>
        <div class="buy_form_div_number" id="buy_form_div_number">
            <section id="buy_color_form" class="buy_form_color">
                <form action="">
                    <div class="buy_form">
                        <div class="buy_heading">
                            <h3>Win Go 30Seconds</h3>
                            <p>Selected: <span id="selected_color">None</span></p>
                        </div>


                        <div class="buy_balance">
                            <p>Balance</p>
                            <div>
                                <span id="balance_value_1" class="balance_value active">1</span>
                                <span id="balance_value_2" class="balance_value">10</span>
                                <span id="balance_value_3" class="balance_value">100</span>
                                <span id="balance_value_4" class="balance_value">1000</span>
                            </div>
                        </div>
                        <div class="buy_quantity">
                            <p>Quantity</p>
                            <div>
                                <span id="dec_quantity" class="active">-</span>
                                <span id="quantity_value">1</span>
                                <span id="inc_quantity" class="active">+</span>
                            </div>
                        </div>
                        <div class="buy_multiply">
                            <span class="multiply_value active">1</span>
                            <span class="multiply_value">5</span>
                            <span class="multiply_value">10</span>
                            <span class="multiply_value">20</span>
                            <span class="multiply_value">50</span>
                            <span class="multiply_value">100</span>
                        </div>

                        <div class="buy_policy">
                            <input type="radio">
                            <p>I agree</p><span>|Pre-sale rules|</span>
                        </div>
                        <div class="buy_btn">
                            <p id="buy_form_cancle">Cancle</p>
                            <input id="buy_btn_total" type="submit" value="Total amount â‚¹1.00">
                        </div>
                    </div>
                </form>
            </section>
        </div>
        <div class="buy_form_div_size" id="buy_form_div_size">
            <section id="buy_color_form" class="buy_form_color">
                <form action="">
                    <div class="buy_form">
                        <div class="buy_heading">
                            <h3>Win Go 5Min</h3>
                            <p>Selected: <span id="selected_color">None</span></p>
                        </div>


                        <div class="buy_balance">
                            <p>Balance</p>
                            <div>
                                <span id="balance_value_1" class="balance_value active">1</span>
                                <span id="balance_value_2" class="balance_value">10</span>
                                <span id="balance_value_3" class="balance_value">100</span>
                                <span id="balance_value_4" class="balance_value">1000</span>
                            </div>
                        </div>
                        <div class="buy_quantity">
                            <p>Quantity</p>
                            <div>
                                <span id="dec_quantity" class="active">-</span>
                                <span id="quantity_value">1</span>
                                <span id="inc_quantity" class="active">+</span>
                            </div>
                        </div>
                        <div class="buy_multiply">
                            <span class="multiply_value active">1</span>
                            <span class="multiply_value">5</span>
                            <span class="multiply_value">10</span>
                            <span class="multiply_value">20</span>
                            <span class="multiply_value">50</span>
                            <span class="multiply_value">100</span>
                        </div>

                        <div class="buy_policy">
                            <input type="radio">
                            <p>I agree</p><span>|Pre-sale rules|</span>
                        </div>
                        <div class="buy_btn">
                            <p id="buy_form_cancle">Cancle</p>
                            <input id="buy_btn_total" type="submit" value="Total amount â‚¹1.00">
                        </div>
                    </div>
                </form>
            </section>
        </div>
    </section>

    <!-- pagination script start -->
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <!-- <script>
        function loadPage(pageNumber) {
            $.ajax({
                url: window.location.pathname,  // Current URL
                type: 'GET',
                data: {
                    page: pageNumber
                },
                success: function(data) {
                    let resultsDiv = $('#results');
                    resultsDiv.empty();
                    
                    data.round_results.forEach(function(result) {
                        resultsDiv.append(`
                            <tr>
                                <td id="round_id">${result.round__game_id}</td>
                                <td></td>
                                <td></td>
                                <td id="win_color">${result.win_color}</td>
                            </tr>
                        `);
                    });

                    let paginationDiv = $('.pagination .step-links');
                    paginationDiv.empty();

                    if (data.has_previous) {
                        paginationDiv.append(`
                            <a href="#" onclick="loadPage(1)">&laquo; first</a>
                            <a href="#" onclick="loadPage(${data.previous_page_number})">previous</a>
                        `);
                    }

                    paginationDiv.append(`
                        <span class="current">
                            Page ${data.current_page} of ${data.num_pages}.
                        </span>
                    `);

                    if (data.has_next) {
                        paginationDiv.append(`
                            <a href="#" onclick="loadPage(${data.next_page_number})">next</a>
                            <a href="#" onclick="loadPage(${data.num_pages})">last &raquo;</a>
                        `);
                    }
                }
            });
        }
    </script> -->
    <!-- pagination script end -->


    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.7.2/axios.min.js"
        integrity="sha512-JSCFHhKDilTRRXe9ak/FJ28dcpOJxzQaCd3Xg8MyF6XFjODhy/YMCM8HW0TFDckNHWUewW+kfvhin43hKtJxAw=="
        crossorigin="anonymous" referrerpolicy="no-referrer"></script>


    <script>
        const gameSocket = new WebSocket(
            'ws://' + window.location.host + '/ws/test/'
        );

        let countdown; // Define the countdown interval variable
        let game_round_id;
        gameSocket.onmessage = function (e) {
            const data = JSON.parse(e.data);
            console.log(data.game_round);
            if (data.game_round && data.game_round.id) {
                game_round_id = data.game_round.game_id; // Update game_round_id

                document.getElementById('game_round_id').innerText = data.game_round.game_id;
                const timerElement = document.getElementsByClassName('ticket_time')[0];

                // Clear the previous countdown interval if it exists
                if (countdown) {
                    clearInterval(countdown);
                }

                startCountdown(timerElement, 30);
            } else {
                console.error('Invalid game_round data received:', data.game_round);
            }
        };

        gameSocket.onclose = function (e) {
            console.error('Game socket closed unexpectedly');
        };


        document.getElementById('buy_btn_total').addEventListener('click', () => {
            let amount = document.getElementById('total_amount').value;
            let bet_color = document.getElementById('bet_color').value;
            if (game_round_id) {
                console.log('Game round ID:', game_round_id);
                axios.post('/api/game_bet', { id: game_round_id, amount: amount, bet_color: bet_color })
                    .then(response => {
                        console.log('Bet response:', response.data);
                    })
                    .catch(error => {
                        console.error('Error making bet request:', error);
                    });
            } else {
                console.error('No game_round_id available.');
            }
        });

        function startCountdown(timerElement, duration) {
            let time = duration;
            updateDisplay(timerElement, time);
            countdown = setInterval(() => {
                time--;
                if (time < 0) {
                    time = duration;
                }
                updateDisplay(timerElement, time);
            }, 1000);
        }

        function updateDisplay(timerElement, time) {
            const minutes = Math.floor(time / 60);
            const seconds = time % 60;
            const minuteTens = Math.floor(minutes / 10);
            const minuteOnes = minutes % 10;
            const secondTens = Math.floor(seconds / 10);
            const secondOnes = seconds % 10;

            const timeDivs = timerElement.querySelectorAll('.time');
            timeDivs[0].textContent = minuteTens;
            timeDivs[1].textContent = minuteOnes;
            timeDivs[3].textContent = secondTens;
            timeDivs[4].textContent = secondOnes;
        }
    </script>

    {% comment %}
    <script>
        let gameSocket;
        let reconnectInterval;
        let countdown;
        let game_round_id;

        function initializeWebSocket() {
            gameSocket = new WebSocket(
                'wss://' + window.location.host + '/ws/test/'
            );

            gameSocket.onopen = function () {
                console.log('WebSocket connection established');
                clearInterval(reconnectInterval);
            };

            gameSocket.onmessage = function (e) {
                const data = JSON.parse(e.data);
                console.log(data.game_round);
                if (data.game_round && data.game_round.id) {
                    game_round_id = data.game_round.game_id; // Update game_round_id

                    document.getElementById('game_round_id').innerText = data.game_round.game_id;
                    const timerElement = document.getElementsByClassName('ticket_time')[0];

                    // Clear the previous countdown interval if it exists
                    if (countdown) {
                        clearInterval(countdown);
                    }

                    startCountdown(timerElement, 30);
                } else {
                    console.error('Invalid game_round data received:', data.game_round);
                }
            };

            gameSocket.onclose = function (e) {
                console.error('Game socket closed unexpectedly. Attempting to reconnect...');
                attemptReconnect();
            };

            gameSocket.onerror = function (e) {
                console.error('WebSocket error:', e);
                gameSocket.close();
            };
        }

        function attemptReconnect() {
            reconnectInterval = setInterval(() => {
                console.log('Attempting to reconnect...');
                if (gameSocket.readyState === WebSocket.CLOSED || gameSocket.readyState === WebSocket.CLOSING) {
                    initializeWebSocket();
                }
            }, 2000);
        }

        document.getElementById('buy_btn_total').addEventListener('click', () => {
            let amount = document.getElementById('total_amount').value;
            let bet_color = document.getElementById('bet_color').value;
            if (game_round_id) {
                console.log('Game round ID:', game_round_id);
                axios.post('/api/game_bet', { id: game_round_id, amount: amount, bet_color: bet_color })
                    .then(response => {
                        console.log('Bet response:', response.data);
                    })
                    .catch(error => {
                        console.error('Error making bet request:', error);
                    });
            } else {
                console.error('No game_round_id available.');
            }
        });

        function startCountdown(timerElement, duration) {
            let time = duration;
            updateDisplay(timerElement, time);
            countdown = setInterval(() => {
                time--;
                if (time < 0) {
                    time = duration;
                }
                updateDisplay(timerElement, time);
            }, 1000);
        }

        function updateDisplay(timerElement, time) {
            const minutes = Math.floor(time / 60);
            const seconds = time % 60;
            const minuteTens = Math.floor(minutes / 10);
            const minuteOnes = minutes % 10;
            const secondTens = Math.floor(seconds / 10);
            const secondOnes = seconds % 10;

            const timeDivs = timerElement.querySelectorAll('.time');
            timeDivs[0].textContent = minuteTens;
            timeDivs[1].textContent = minuteOnes;
            timeDivs[3].textContent = secondTens;
            timeDivs[4].textContent = secondOnes;
        }

        // Initialize WebSocket connection when the script is first loaded
        initializeWebSocket();
    </script>
    {% endcomment %}

    {% comment %}
    <script>
        const winSocket = new WebSocket(
            'ws://' + window.location.host + '/ws/game_result/'
        );

        winSocket.onmessage = function (e) {
            const data = JSON.parse(e.data);
            console.log("result herer")
            console.log(data.game_round.win_color);
            document.getElementById('round_id').innerText = data.game_round.game_id
            document.getElementById('win_color').innerText = data.game_round.win_color
            console.log("result showed")
        };
        winSocket.onclose = function (e) {
            console.error('Winner socket closed unexpectedly');
        };
    </script> {% endcomment %}

    <script>
        const winSocket = new WebSocket(
            'ws://' + window.location.host + '/ws/game_result/'
        );

        winSocket.onmessage = function (e) {
            try {
                const data = JSON.parse(e.data);
                console.log("result here");

                if (data.game_round) {
                    console.log(data.game_round.win_color);
                    document.getElementById('round_id').innerText = data.game_round.game_id;
                    document.getElementById('win_color').innerText = data.game_round.win_color;
                    console.log("result showed");
                } else {
                    console.error("game_round is undefined");
                }
            } catch (error) {
                console.error("Error parsing message:", error);
            }
        };

        winSocket.onclose = function (e) {
            console.error('Winner socket closed unexpectedly');
        };
    </script>


    <!-- color bet form  -->
    <script>

        // close and open the form
        var color_btn = document.getElementsByClassName("game_color_cl");
        var selected_color = document.getElementById('selected_color')

        for (let i = 0; i < color_btn.length; i++) {
            color_btn[i].addEventListener('click', () => {
                document.getElementById("buy_form_div").classList.toggle("active");
                selected_color.textContent = color_btn[i].textContent
                selected_color.value = color_btn[i].textContent
            });
        }

        document.getElementById("buy_form_cancle").addEventListener("click", () => {
            document.getElementById("buy_form_div").classList.toggle("active");
        })

    </script>

    <!-- number bet form -->
    <script>

        // close and open the form
        var color_btn = document.getElementsByClassName("game_number_cl");
        var selected_color = document.getElementById('selected_color')

        for (let i = 0; i < color_btn.length; i++) {
            color_btn[i].addEventListener('click', () => {
                document.getElementById("buy_form_div_size").classList.toggle("active");
                selected_color.textContent = color_btn[i].textContent
                selected_color.value = color_btn[i].textContent
            });
        }

        document.getElementById("buy_form_cancle").addEventListener("click", () => {
            document.getElementById("buy_form_div_size").classList.toggle("active");
        })

    </script>
    <!-- size bet form -->
    <script>

        // close and open the form
        var color_btn = document.getElementsByClassName("game_size_cl");
        var selected_color = document.getElementById('selected_color')

        for (let i = 0; i < color_btn.length; i++) {
            color_btn[i].addEventListener('click', () => {
                document.getElementById("buy_form_div_number").classList.toggle("active");
                selected_color.textContent = color_btn[i].textContent
                selected_color.value = color_btn[i].textContent
            });
        }

        document.getElementById("buy_form_cancle").addEventListener("click", () => {
            document.getElementById("buy_form_div_number").classList.toggle("active");
        })

    </script>

    <script>
        // calculating the lot price

        var balance = document.querySelectorAll('.balance_value')
        var multiply = document.querySelectorAll('.multiply_value')
        var quantity = document.getElementById('quantity_value')
        var buy_btn_total = document.getElementById('buy_btn_total')

        var new_balance = 1;
        var new_quantity;

        balance.forEach(item => {
            console.log(item)
            item.addEventListener("click", () => {
                balance.forEach(i => i.classList.remove('active'))
                item.classList.add('active')
                buy_btn_total.value = `Total amount â‚¹${parseInt(item.textContent) * parseInt(quantity.textContent)}`
                new_balance = parseInt(item.textContent)
                document.getElementById('total_amount').value = parseInt(item.textContent) * parseInt(quantity.textContent)
                // console.log(item.textContent)

            })
        })

        console.log(new_balance);

        multiply.forEach(item => {
            console.log(item)
            item.addEventListener("click", () => {
                multiply.forEach(i => i.classList.remove('active'))
                item.classList.add('active')
                quantity.textContent = item.textContent
                // console.log(new_balance)

                buy_btn_total.value = `Total amount â‚¹${parseInt(new_balance) * parseInt(item.textContent)}`
                document.getElementById('total_amount').value = parseInt(new_balance) * parseInt(item.textContent)
                // console.log(item.textContent)
                new_quantity = parseInt(item.textContent)
                console.log(new_balance)

            })
        })

        document.getElementById('dec_quantity').addEventListener('click', () => {
            if (quantity.textContent == 1) {
                quantity.textContent = 1
            } else {
                quantity.textContent = parseInt(quantity.textContent) - 1;
                new_quantity = parseInt(quantity.textContent)
                buy_btn_total.value = `Total amount â‚¹${parseInt(new_balance) * parseInt(new_quantity)}`
                document.getElementById('total_amount').value = parseInt(new_balance) * parseInt(new_quantity)
            }
        })

        document.getElementById('inc_quantity').addEventListener('click', () => {
            if (quantity.textContent == 1000) {
                quantity.textContent = 1000
            } else {
                quantity.textContent = parseInt(quantity.textContent) + 1;
                new_quantity = parseInt(quantity.textContent)
                buy_btn_total.value = `Total amount â‚¹${parseInt(new_balance) * parseInt(new_quantity)}`
                document.getElementById('total_amount').value = parseInt(new_balance) * parseInt(new_quantity)

            }
        })

    </script>

</body>

</html>